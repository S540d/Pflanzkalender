<!DOCTYPE html>
<html lang="en">
  <head>
  <script>
    // Track page load performance
    (function() {
      const startTime = Date.now();

      // Track what gets loaded
      const loadedResources = {
        scripts: [],
        stylesheets: [],
        failed: []
      };

      // Monitor all script tags
      document.addEventListener('DOMContentLoaded', function() {
        const scripts = document.querySelectorAll('script[src]');
        scripts.forEach(function(script) {
          const src = script.src;

          script.addEventListener('load', function() {
            loadedResources.scripts.push(src);
            console.log('[Loading] ‚úÖ Script loaded:', src);
          });

          script.addEventListener('error', function() {
            loadedResources.failed.push(src);
            console.error('[Loading] ‚ùå Script failed:', src);
          });
        });

        // Check if app root exists
        setTimeout(function() {
          const root = document.getElementById('root');
          if (!root) {
            console.error('[Loading] ‚ùå No root element found!');
          } else if (root.children.length === 0) {
            console.error('[Loading] ‚ùå Root element is empty - app not rendering');
            console.log('[Loading] Loaded scripts:', loadedResources.scripts.length);
            console.log('[Loading] Failed scripts:', loadedResources.failed.length);
          } else {
            console.log('[Loading] ‚úÖ App rendered successfully');
          }
        }, 3000);
      });

      // Log page load complete
      window.addEventListener('load', function() {
        const loadTime = Date.now() - startTime;
        console.log('[Loading] Page load complete in ' + loadTime + 'ms');
      });
    })();
  </script>

  <script>
    // FORCE CACHE CLEAR - This runs immediately before anything else
    (function() {
      console.log('[CacheClear] Starting aggressive cache cleanup...');

      // 1. Unregister ALL service workers
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistrations().then(function(registrations) {
          console.log('[CacheClear] Found ' + registrations.length + ' service worker(s)');
          for (let registration of registrations) {
            registration.unregister().then(function(success) {
              if (success) {
                console.log('[CacheClear] Unregistered service worker:', registration.scope);
              }
            });
          }
        });
      }

      // 2. Delete ALL caches
      if ('caches' in window) {
        caches.keys().then(function(cacheNames) {
          console.log('[CacheClear] Found ' + cacheNames.length + ' cache(s)');
          return Promise.all(
            cacheNames.map(function(cacheName) {
              console.log('[CacheClear] Deleting cache:', cacheName);
              return caches.delete(cacheName);
            })
          );
        }).then(function() {
          console.log('[CacheClear] All caches deleted');
        });
      }

      // 3. Clear localStorage flag for version checking
      try {
        localStorage.removeItem('app-version');
        console.log('[CacheClear] Cleared app-version from localStorage');
      } catch (e) {
        console.error('[CacheClear] Could not clear localStorage:', e);
      }

      console.log('[CacheClear] Cache cleanup complete!');
    })();
  </script>

    <meta charset="utf-8" />
    <meta httpEquiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>Pflanzkalender</title>
    <!-- The `react-native-web` recommended style reset: https://necolas.github.io/react-native-web/docs/setup/#root-element -->
    <style id="expo-reset">
      /* These styles make the body full-height */
      html,
      body {
        height: 100%;
      }
      /* These styles disable body scrolling if you are using <ScrollView> */
      body {
        overflow: hidden;
      }
      /* These styles make the root element full-height */
      #root {
        display: flex;
        height: 100%;
        flex: 1;
      }
    </style>
  <link rel="icon" href="/Pflanzkalender-testing/favicon.ico" />
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta name="version" content="1.0.0-testing">
<meta name="build-timestamp" content="1761480437423">

  <style>
    #mobile-debug-overlay {
      position: fixed;
      top: 60px;
      left: 10px;
      right: 10px;
      background: rgba(0, 0, 0, 0.95);
      color: #00ff00;
      padding: 15px;
      font-family: monospace;
      font-size: 11px;
      z-index: 999999;
      max-height: 80vh;
      overflow-y: auto;
      border: 2px solid #00ff00;
      border-radius: 5px;
      display: none;
    }
    #mobile-debug-overlay.visible {
      display: block;
    }
    #mobile-debug-overlay .error {
      color: #ff4444;
      margin: 5px 0;
      border-left: 3px solid #ff4444;
      padding-left: 8px;
    }
    #mobile-debug-overlay .info {
      color: #00ff00;
      margin: 5px 0;
    }
    #mobile-debug-overlay .warning {
      color: #ffaa00;
      margin: 5px 0;
      border-left: 3px solid #ffaa00;
      padding-left: 8px;
    }
    #mobile-debug-overlay .timestamp {
      color: #888;
      font-size: 9px;
    }
    #mobile-debug-toggle {
      position: fixed;
      bottom: 10px;
      right: 10px;
      background: #00ff00;
      color: black;
      padding: 10px 15px;
      border-radius: 20px;
      z-index: 9999999;
      font-weight: bold;
      cursor: pointer;
      font-size: 14px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }
  </style>
</head>

  <body>
  <div id="mobile-debug-toggle">DEBUG</div>
  <div id="mobile-debug-overlay">
    <div style="font-weight: bold; margin-bottom: 10px; color: white;">üì± Mobile Debug Console</div>
    <div id="debug-log"></div>
  </div>
  <script>
    (function() {
      // Mobile Debug Logger
      const debugOverlay = document.getElementById('mobile-debug-overlay');
      const debugLog = document.getElementById('debug-log');
      const debugToggle = document.getElementById('mobile-debug-toggle');
      let isVisible = true; // Start visible to show initial loading

      debugOverlay.classList.add('visible');

      debugToggle.addEventListener('click', function() {
        isVisible = !isVisible;
        if (isVisible) {
          debugOverlay.classList.add('visible');
        } else {
          debugOverlay.classList.remove('visible');
        }
      });

      function addLog(message, type = 'info') {
        const timestamp = new Date().toLocaleTimeString();
        const entry = document.createElement('div');
        entry.className = type;
        entry.innerHTML = '<span class="timestamp">[' + timestamp + ']</span> ' + message;
        debugLog.appendChild(entry);
        debugLog.scrollTop = debugLog.scrollHeight;
      }

      // Log initial info
      addLog('üöÄ App starting...', 'info');
      addLog('User Agent: ' + navigator.userAgent, 'info');
      addLog('Screen: ' + window.innerWidth + 'x' + window.innerHeight, 'info');
      addLog('Base URL: ' + window.location.href, 'info');

      // Intercept console methods
      const originalLog = console.log;
      const originalError = console.error;
      const originalWarn = console.warn;

      console.log = function(...args) {
        addLog(args.join(' '), 'info');
        originalLog.apply(console, args);
      };

      console.error = function(...args) {
        addLog('‚ùå ' + args.join(' '), 'error');
        originalError.apply(console, args);
      };

      console.warn = function(...args) {
        addLog('‚ö†Ô∏è ' + args.join(' '), 'warning');
        originalWarn.apply(console, args);
      };

      // Catch all unhandled errors
      window.addEventListener('error', function(event) {
        addLog('‚ùå ERROR: ' + event.message + ' at ' + event.filename + ':' + event.lineno, 'error');
      });

      // Catch unhandled promise rejections
      window.addEventListener('unhandledrejection', function(event) {
        addLog('‚ùå PROMISE REJECTION: ' + (event.reason?.message || event.reason), 'error');
      });

      // Check if React bundle loads
      addLog('‚è≥ Waiting for React to load...', 'info');

      // Check after 3 seconds if React loaded
      setTimeout(function() {
        if (typeof React === 'undefined') {
          addLog('‚ùå React not loaded after 3s - bundle may have failed', 'error');
        } else {
          addLog('‚úÖ React is loaded', 'info');
        }
      }, 3000);

      // Check after 5 seconds if app rendered
      setTimeout(function() {
        const appRoot = document.getElementById('root');
        if (appRoot && appRoot.children.length === 0) {
          addLog('‚ùå App root is empty - React app not rendering', 'error');
        } else if (appRoot && appRoot.children.length > 0) {
          addLog('‚úÖ App rendered successfully', 'info');
        }
      }, 5000);

      // Log service worker status
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistrations().then(function(registrations) {
          if (registrations.length > 0) {
            addLog('‚ÑπÔ∏è Service Workers found: ' + registrations.length, 'info');
            registrations.forEach(function(reg) {
              addLog('  - Scope: ' + reg.scope, 'info');
            });
          } else {
            addLog('‚ÑπÔ∏è No Service Workers registered', 'info');
          }
        });
      }

      // Log cache status
      if ('caches' in window) {
        caches.keys().then(function(names) {
          if (names.length > 0) {
            addLog('‚ÑπÔ∏è Caches found: ' + names.join(', '), 'info');
          } else {
            addLog('‚ÑπÔ∏è No caches found', 'info');
          }
        });
      }

      // Check if main bundle exists
      addLog('üîç Checking for main bundle...', 'info');
      fetch(window.location.origin + window.location.pathname + '_expo/static/js/web/entry-*.js'.replace('*', ''))
        .then(function() {
          addLog('‚úÖ Main bundle found', 'info');
        })
        .catch(function() {
          addLog('‚ö†Ô∏è Could not verify main bundle', 'warning');
        });

      addLog('üìä Debug logger initialized', 'info');
    })();
  </script>

  <div id="failsafe-banner" style="
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 20px;
    text-align: center;
    font-family: Arial, sans-serif;
    font-size: 16px;
    font-weight: bold;
    z-index: 99999999;
    box-shadow: 0 4px 6px rgba(0,0,0,0.3);
    border-bottom: 4px solid #fff;
  ">
    <div style="font-size: 24px; margin-bottom: 10px;">üîç DEBUG MODUS</div>
    <div id="status-message" style="font-size: 14px; margin-bottom: 10px;">‚è≥ Seite l√§dt...</div>
    <div style="font-size: 12px; opacity: 0.9;">Wenn diese Nachricht verschwindet, funktioniert JavaScript!</div>
  </div>
  <script>
    // This script runs IMMEDIATELY and updates the banner
    (function() {
      var statusMsg = document.getElementById('status-message');
      var banner = document.getElementById('failsafe-banner');

      // Step 1: JavaScript is running
      statusMsg.innerHTML = '‚úÖ JavaScript l√§uft!';
      statusMsg.style.color = '#00ff00';

      // Step 2: Check if DOM loaded
      document.addEventListener('DOMContentLoaded', function() {
        statusMsg.innerHTML = '‚úÖ DOM geladen! Warte auf React...';

        // Step 3: Check if React loaded after 2 seconds
        setTimeout(function() {
          if (typeof React !== 'undefined') {
            statusMsg.innerHTML = '‚úÖ React geladen! App sollte rendern...';
          } else {
            statusMsg.innerHTML = '‚ùå React nicht gefunden!';
            statusMsg.style.color = '#ff4444';
          }
        }, 2000);

        // Step 4: Check if app rendered after 5 seconds
        setTimeout(function() {
          var root = document.getElementById('root');
          if (root && root.children.length > 0) {
            statusMsg.innerHTML = '‚úÖ APP FUNKTIONIERT!';
            statusMsg.style.color = '#00ff00';
            // Hide banner after success
            setTimeout(function() {
              banner.style.display = 'none';
            }, 3000);
          } else {
            statusMsg.innerHTML = '‚ùå APP RENDERT NICHT! Root ist leer.';
            statusMsg.style.color = '#ff4444';
            // Keep banner visible to show error
          }
        }, 5000);
      });

      // Catch any errors
      window.addEventListener('error', function(e) {
        statusMsg.innerHTML = '‚ùå FEHLER: ' + e.message;
        statusMsg.style.color = '#ff4444';
        banner.style.background = 'linear-gradient(135deg, #ff4444 0%, #cc0000 100%)';
      });
    })();
  </script>

<div style="position: fixed; top: 0; left: 0; right: 0; background: #ff9800; color: #000; padding: 8px; text-align: center; font-weight: bold; z-index: 99999999;">
  ‚ö†Ô∏è TESTING ENVIRONMENT
</div>

    <!-- Use static rendering with Expo Router to support running without JavaScript. -->
    <noscript>
      You need to enable JavaScript to run this app.
    </noscript>
    <!-- The root element for your Expo app. -->
    <div id="root"></div>
  <script src="/Pflanzkalender-testing/_expo/static/js/web/index-35ea90dc6d3abace7c450cc417a966f2.js" defer></script>

  <script>
    // Service Worker Registration with Update Check
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('/Pflanzkalender-testing/service-worker.js')
          .then(function(registration) {
            console.log('[App] ServiceWorker registered:', registration.scope);

            // Check for updates every 30 seconds
            setInterval(function() {
              registration.update();
            }, 30000);

            // Listen for new service worker installation
            registration.addEventListener('updatefound', function() {
              const newWorker = registration.installing;

              newWorker.addEventListener('statechange', function() {
                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                  // New version available - force reload
                  console.log('[App] New version available! Reloading...');

                  // Ask new service worker to skip waiting
                  newWorker.postMessage({ type: 'SKIP_WAITING' });

                  // Reload after a short delay
                  setTimeout(function() {
                    window.location.reload(true);
                  }, 1000);
                }
              });
            });
          })
          .catch(function(err) {
            console.error('[App] ServiceWorker registration failed:', err);
          });

        // Reload page when service worker takes control
        navigator.serviceWorker.addEventListener('controllerchange', function() {
          console.log('[App] Controller changed, reloading...');
          window.location.reload(true);
        });
      });
    }

    // Force clear cache on version mismatch
    (function checkVersion() {
      const currentVersion = document.querySelector('meta[name="version"]')?.content;
      const storedVersion = localStorage.getItem('app-version');

      if (storedVersion && storedVersion !== currentVersion) {
        console.log('[App] Version changed:', storedVersion, '->', currentVersion);
        console.log('[App] Clearing cache and reloading...');

        // Clear all caches
        if ('caches' in window) {
          caches.keys().then(function(names) {
            names.forEach(function(name) {
              caches.delete(name);
            });
          });
        }

        // Clear localStorage
        localStorage.clear();

        // Set new version and reload
        localStorage.setItem('app-version', currentVersion);
        window.location.reload(true);
      } else if (currentVersion) {
        localStorage.setItem('app-version', currentVersion);
      }
    })();
  </script>
  </body>
</html>
<!-- TESTING ENVIRONMENT -->
